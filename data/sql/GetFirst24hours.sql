WITH timeranges as (
  SELECT hadm_id, admittime, admittime + interval '24 hour' as endtime
  FROM admissions
), topLabEvents as (
  SELECT * FROM labevents WHERE labevents.itemid in ('51253', '919', '51029', '51311', '8441', '50834', '51401', '51162', '51050', '927', '51483', '51293', '227443', '51329', '935', '51153', '663', '547', '549', '51290', '184', '646',
     '51322', '811', '51443', '161', '50845', '51166', '425', '599', '51316', '88', '925', '432', '813', '51459', '51201', '707', '51432', '593', '51318', '51179', '637', '50977', '51056', '50869', '156',
      '479', '51019', '51378', '51485', '85', '51473', '837', '87', '50832', '51396', '827', '51121', '51242', '51185', '8456', '51327', '324', '212', '51021', '211', '159', '51477', '428', '742', '917',
       '51403', '51195', '1046', '51012', '51171', '82', '54', '50959', '51414', '51170', '51031', '51480', '294', '220615', '50947', '50870', '51142', '51173', '220602', '51141', '50859', '456', '83', '77', '525',
        '51346', '51285', '51304', '51330', '51129', '210', '706', '51520', '762', '51437', '617', '50875', '550', '51504', '220545', '51258', '51435', '926', '1125', '27', '51048', '454', '51189', '51037', '723',
         '916', '80', '50833', '8400', '51367', '51364', '815', '227073', '930', '1127', '51456', '678', '825', '704', '824', '787', '924', '84', '786', '467', '51361', '618', '51055', '51135', '828',
          '220621', '455', '478', '51113', '920', '50846', '31', '51207', '51165', '32', '198', '674', '128', '814', '51308', '50934', '861', '51532', '51169', '781', '51468', '51537', '51023', '51349', '833',
           '8381', '51157', '829', '69', '51389', '51475', '821', '225624', '51472', '227442', '51136', '86', '51295', '220645', '51409', '51119', '791', '51186', '788', '51126', '51083', '677', '8480', '50840', '644',
            '51521', '51282', '51211')
), topChartEvents as (
  SELECT * FROM chartevents WHERE chartevents.itemid in ('51253', '919', '51029', '51311', '8441', '50834', '51401', '51162', '51050', '927', '51483', '51293', '227443', '51329', '935', '51153', '663', '547', '549', '51290', '184', '646',
     '51322', '811', '51443', '161', '50845', '51166', '425', '599', '51316', '88', '925', '432', '813', '51459', '51201', '707', '51432', '593', '51318', '51179', '637', '50977', '51056', '50869', '156',
      '479', '51019', '51378', '51485', '85', '51473', '837', '87', '50832', '51396', '827', '51121', '51242', '51185', '8456', '51327', '324', '212', '51021', '211', '159', '51477', '428', '742', '917',
       '51403', '51195', '1046', '51012', '51171', '82', '54', '50959', '51414', '51170', '51031', '51480', '294', '220615', '50947', '50870', '51142', '51173', '220602', '51141', '50859', '456', '83', '77', '525',
        '51346', '51285', '51304', '51330', '51129', '210', '706', '51520', '762', '51437', '617', '50875', '550', '51504', '220545', '51258', '51435', '926', '1125', '27', '51048', '454', '51189', '51037', '723',
         '916', '80', '50833', '8400', '51367', '51364', '815', '227073', '930', '1127', '51456', '678', '825', '704', '824', '787', '924', '84', '786', '467', '51361', '618', '51055', '51135', '828',
          '220621', '455', '478', '51113', '920', '50846', '31', '51207', '51165', '32', '198', '674', '128', '814', '51308', '50934', '861', '51532', '51169', '781', '51468', '51537', '51023', '51349', '833',
           '8381', '51157', '829', '69', '51389', '51475', '821', '225624', '51472', '227442', '51136', '86', '51295', '220645', '51409', '51119', '791', '51186', '788', '51126', '51083', '677', '8480', '50840', '644',
            '51521', '51282', '51211')
), labeventsInRange as (
  SELECT topLabEvents.hadm_id, itemid, charttime, value, valuenum
  FROM topLabEvents
  LEFT JOIN timeranges on timeranges.hadm_id = topLabEvents.hadm_id
  WHERE (charttime, charttime) OVERLAPS (timeranges.admittime, timeranges.endtime)
), charteventsInRange as (
  SELECT topChartEvents.hadm_id, itemid, charttime, value, valuenum
  FROM topChartEvents
  LEFT JOIN timeranges on timeranges.hadm_id = topChartEvents.hadm_id
  WHERE (charttime, charttime) OVERLAPS (timeranges.admittime, timeranges.endtime)
)
SELECT *
FROM labeventsInRange
UNION
SELECT *
FROM charteventsInRange
